- name: Set image tags
  id: vars
  run: |
    OWNER=$(echo "${{ github.repository_owner }}" | tr '[:upper:]' '[:lower:]')
    IMAGE_NAME="ghcr.io/$OWNER/my-app"
    echo "IMAGE_NAME=$IMAGE_NAME" >> $GITHUB_ENV
    
    TAGS="latest"

    if [[ "${GITHUB_REF_TYPE}" == "tag" ]]; then
      TAGS="${GITHUB_REF_NAME}"
    else
      if [[ "${GITHUB_REF_NAME}" == "main" ]]; then
        TAGS="$TAGS,${GITHUB_SHA::7}"
      else
        BRANCH_TAG=$(echo "${GITHUB_REF_NAME}" | tr / - | tr '[:upper:]' '[:lower:]')
        TAGS="$BRANCH_TAG,${BRANCH_TAG}-${GITHUB_SHA::7}"
      fi
    fi

    echo "TAGS=$TAGS" >> $GITHUB_ENV
